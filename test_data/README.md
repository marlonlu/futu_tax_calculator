# 测试数据说明

本目录包含用于验证股票期权交易盈利统计脚本的测试用例。每个测试用例都放在独立的文件夹中，便于管理和理解。

## 测试用例目录结构

### 股票测试用例

| 目录名 | 测试场景 | 预期结果 |
|--------|----------|----------|
| `01_股票同年完整交易` | 当年度完整买卖流水 | 正常计算盈亏，按FIFO/移动平均加权匹配 |
| `02_股票跨年部分卖出` | 当年买入，跨年部分卖出 | 盈利分别计入对应年度 |
| `03_股票仅卖出无买入` | 只有卖出，无买入记录 | 标记为需要手动核查 |
| `04_股票当年买次年卖` | 当年买入，次年全部卖出 | 盈利计入卖出年度 |
| `05_股票复杂FIFO场景` | 复杂FIFO匹配场景 | 验证FIFO算法正确性 |

### 期权测试用例

| 目录名 | 测试场景 | 预期结果 |
|--------|----------|----------|
| `06_期权做多同年交易` | 期权做多，当年度完整交易 | 期权价格乘以100，正常盈亏计算 |
| `07_期权做多跨年交易` | 期权做多，跨年交易 | 跨年度盈利计算 |
| `08_期权做空同年交易` | 期权做空，当年度完整交易 | 做空盈利计算 |
| `09_期权做空跨年交易` | 期权做空，跨年交易 | 跨年度做空盈利 |
| `10_期权做多到期作废` | 期权做多，无效（到期作废） | 识别未平仓期权 |
| `11_期权做空到期获利` | 期权卖空，作废（到期获利） | 做空到期获利，成本价为0 |
| `12_期权复杂混合交易` | 期权复杂混合交易场景 | 复杂期权交易处理 |
| `13_期权跨年复杂场景` | 期权跨年复杂场景 | 跨年复杂期权处理 |

### 综合测试用例

| 目录名 | 测试场景 | 预期结果 |
|--------|----------|----------|
| `14_股票期权混合交易` | 股票期权混合交易 | 分别处理股票和期权 |
| `15_无效数据处理测试` | 无效数据处理测试 | 过滤无效数据，记录错误原因 |

## 使用方法

每个测试用例文件夹包含：
- `test_data.csv`: 测试数据文件
- `README.md`: 详细的测试说明文档

### 运行单个测试用例

```bash
# FIFO算法（原版脚本已被修改为移动平均加权）
python stock_option_tax_calculator.py "test_data/01_股票同年完整交易/test_data.csv"

# 移动平均加权算法
python stock_option_tax_calculator_weighted_avg.py "test_data/01_股票同年完整交易/test_data.csv"
```

### 运行所有测试用例

```bash
python run_tests.py
```

### 算法对比

```bash
python simple_compare.py
```

## 验证重点

1. **FIFO算法**：验证先进先出匹配的正确性
2. **移动平均加权算法**：验证加权平均成本价计算
3. **期权价格处理**：确认期权价格正确乘以100
4. **跨年度处理**：验证年度分组和盈利分配
5. **异常数据处理**：确认无效数据的过滤和标记
6. **算法差异对比**：比较两种算法的计算结果差异

## 数据格式

所有测试数据文件都遵循以下CSV格式：
```
股票代码,数量,成交价格,买卖方向,结算币种,合计手续费,交易时间
```

- **股票代码**: 如 `US.AAPL`（股票）或 `US.AAPL240315P160000`（期权）
- **数量**: 交易数量
- **成交价格**: 成交价格
- **买卖方向**: `Buy` 或 `Sell`
- **结算币种**: `USD`、`HKD` 等
- **合计手续费**: 交易手续费
- **交易时间**: 格式为 `YYYY-MM-DD HH:MM:SS`